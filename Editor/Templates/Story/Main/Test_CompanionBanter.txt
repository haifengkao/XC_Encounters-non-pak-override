Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_CompanionBanterTest_Companions(CHARACTER_Wolgraff);
DB_CompanionBanterTest_Companions(CHARACTER_Bairdotr);
DB_CompanionBanterTest_Companions(CHARACTER_Madoc);
DB_CompanionBanterTest_Companions(CHARACTER_Jahan);

DB_CompanionBanterTest_Counter(1);
DB_CompanionBanterTest_PlayCounter(1);

DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Legion_Pos");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Legion_Neg");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Archaeologist_Pos");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Archaeologist_Neg");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Will_Pos");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Will_Neg");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Frederick_Pos");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Frederick_Neg");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Skull_Pos");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Skull_Neg");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Lovers_Pos");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Lovers_Neg");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Mayor");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Bellegar");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Ruby");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Totem");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_CardGame");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_ZandalorRoom");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Tapestry");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_RedImps");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Snowman");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_ImalDead");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Voice1");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Voice2");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Voice3");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Voice4");
DB_CompanionBanterTest(CHARACTER_Wolgraff,"WOL_CC_Voice5");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CC_Lovers");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CC_DAFEntrance");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CC_Ratcatcher");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_LUC_Totem");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_LUC_Roy");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_LUC_Alfie");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_LUC_WitchCave");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_LUC_FumbleRuby");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_HIB_Imps");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_HIB_Stag");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_HIB_Wolves");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CYS_Demons");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CC_Maxine");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CC_Samson");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CC_SamsonMad");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CC_SamsonYeah");
DB_CompanionBanterTest(CHARACTER_Jahan,"JAH_CC_Esmeralda");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_Graveyard");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_BillehGahr");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_ZombieJake");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_Nick");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_Staff");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_Bertia");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_Maxine");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_NorokChildlike");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_FortuneTeller");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_LeaveIcara");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_BoreasStaff");
DB_CompanionBanterTest(CHARACTER_Madoc,"MAD_CC_GetBrandonQuest");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_JakeBraccus");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_CysealPriest");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_DustPlains");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_Prostitute");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_MeetingTroll");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_FumbleClose");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_CeciliaBath");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_AfterMeetingMalbini");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_AfterNadiaRot");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_Kadraskaz");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_TrollCave");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_Attenberah");
DB_CompanionBanterTest(CHARACTER_Bairdotr,"BRD_CC_Mortician");

KBSECTION
PROC
Proc_CompanionBanterTest_GenerateIndeces()
AND
DB_CompanionBanterTest(_Speaker,_Dialog)
AND
DB_CompanionBanterTest_Companions(_Replier)
AND
_Speaker != _Replier
AND
DB_CompanionBanterTest_Counter(_Index)
AND
IntegerSum(_Index,1,_NewIndex)
THEN
DB_CompanionBanterTest_Indexed(_Index,_Dialog,_Speaker,_Replier);
NOT DB_CompanionBanterTest_Counter(_Index);
DB_CompanionBanterTest_Counter(_NewIndex);

IF
TextEventSet("CBT_reset")
AND
DB_CompanionBanterTest_PlayCounter(_Counter)
THEN
NOT DB_CompanionBanterTest_PlayCounter(_Counter);
DB_CompanionBanterTest_PlayCounter(1);

IF
TextEventSet("CBT_skip1")
AND
DB_CompanionBanterTest_PlayCounter(_Counter)
AND
IntegerSum(_Counter,1,_NewCounter)
THEN
NOT DB_CompanionBanterTest_PlayCounter(_Counter);
DB_CompanionBanterTest_PlayCounter(_NewCounter);

IF
TextEventSet("CBT_skip10")
AND
DB_CompanionBanterTest_PlayCounter(_Counter)
AND
IntegerSum(_Counter,10,_NewCounter)
THEN
NOT DB_CompanionBanterTest_PlayCounter(_Counter);
DB_CompanionBanterTest_PlayCounter(_NewCounter);

IF
TextEventSet("CBT_start")
THEN
DB_DLCGiven(4);
CharacterSetOnStage(CHARACTER_Wolgraff,1);
CharacterSetOnStage(CHARACTER_Bairdotr,1);
CharacterTeleportToCharacter(CHARACTER_Bairdotr,CHARACTER_Player1,"");
CharacterTeleportToCharacter(CHARACTER_Wolgraff,CHARACTER_Bairdotr,"");
CharacterTeleportToCharacter(CHARACTER_Madoc,CHARACTER_Wolgraff,"");
CharacterTeleportToCharacter(CHARACTER_Jahan,CHARACTER_Madoc,"");
DialogSetCharacterEvent("Bairdotr_Recruited",CHARACTER_Player1,0);
DialogSetCharacterEvent("Wolgraff_Recruited",CHARACTER_Player1,0);
DialogSetCharacterEvent("Madoc_Recruited",CHARACTER_Player2,0);
DialogSetCharacterEvent("Jahan_Recruited",CHARACTER_Player2,0);
DialogRequestStopForCharacter(CHARACTER_Bairdotr);
DialogRequestStopForCharacter(CHARACTER_Wolgraff);
DialogRequestStopForCharacter(CHARACTER_Madoc);
DialogRequestStopForCharacter(CHARACTER_Jahan);

IF
TextEventSet("CBT_start")
AND
NOT DB_CompanionBanterTest_Indexed(_,_,_,_)
THEN
Proc_CompanionBanterTest_GenerateIndeces();

IF
TextEventSet("CBT_start")
THEN
DB_CompanionBanterTest_Autoplay(1);
Proc_CompanionBanterTest_PlayNext();

IF
TextEventSet("CBT_stop")
THEN
NOT DB_CompanionBanterTest_Autoplay(1);

IF
AutomatedDialogEnded(_Dialog,_)
AND
DB_CompanionBanterTest_Autoplay(1)
AND
DB_CompanionBanterTest_Indexed(_,_Dialog,_,_)
THEN
TimerLaunch("QueueNextCompanionBanterTest",3000);

IF
TimerFinished("QueueNextCompanionBanterTest")
AND
DB_CompanionBanterTest_Autoplay(1)
AND
DB_CompanionBanterTest_PlayCounter(_Index)
AND
IntegerSum(_Index,1,_NewIndex)
THEN
NOT DB_CompanionBanterTest_PlayCounter(_Index);
DB_CompanionBanterTest_PlayCounter(_NewIndex);
Proc_CompanionBanterTest_PlayNext();

PROC
Proc_CompanionBanterTest_PlayNext()
AND
DB_Companion(_Companion)
THEN
NOT DB_Companion(_Companion);

PROC
Proc_CompanionBanterTest_PlayNext()
AND
DB_CompanionBanterTest_PlayCounter(_Counter)
AND
DB_CompanionBanterTest_Indexed(_Counter,_Dialog,_Speaker,_Replier)
THEN
DB_Companion(_Speaker);
DB_Companion(_Replier);
NOT DB_CompanionCommentsFinished(_Speaker,_Dialog);
Proc_CompanionComment(_Speaker,_Dialog,_Speaker);
CharacterDebugText(CHARACTER_Player1,_Dialog);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "DOSStart"
